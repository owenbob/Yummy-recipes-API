
# # Python CircleCI 2.0 configuration file
# #
# # Check https://circleci.com/docs/2.0/language-python/ for more details
# #
# version: 2
# jobs:
#   build:
#     docker:

#       - image: circleci/python:3.6.1
#         environment:
#           TEST_DB: postgresql://yummyrecipes:admin@localhost:5432/test
             
#       - image: circleci/postgres:9.6.6
#         environment:
#           SECRET_KEY: "********"
#           POSTGRES_USER: yummyrecipes
#           POSTGRES_DB: test
#           POSTGRES_PASSWORD: admin

          

#     working_directory: ~/Yummy-recipes-API

#     steps:
#       - checkout

#       # Download and cache dependencies
#       - restore_cache:
#           keys:
#           - v1-dependencies-{{ checksum "requirements.txt" }}
#           # fallback to using the latest cache if no exact match is found
#           - v1-dependencies-

#       - run:
#           name: install dependencies
#           command: |
#             python3 -m venv venv
#             . venv/bin/activate
#             pip install -r requirements.txt

#       - save_cache:
#           paths:
#             - ./venv
#           key: v1-dependencies-{{ checksum "requirements.txt" }}
        
#       # run tests!
#       # this example uses Django's built-in test-runner
#       # other common Python testing frameworks include pytest and nose
#       # https://pytest.org
#       # https://nose.readthedocs.io
#       - run:
#           name: run tests
#           command: |
#             . venv/bin/activate
#             pytest

#       - store_artifacts:
#           path: test-reports
#           destination: test-reports


machine:
  python:
    version: 3.6.3

  environment:
    CIRCLE_ENV: test
    DATABASE_URL: postgresql://yummyrecipes:admin@localhost:5432/test
    SECRET_KEY: "********"
  
  before_script:
    - sudo -u postgres createuser yummyrecipes
    - sudo -u postgres createdb yummy_recipes
    - sudo -u postgres createdb test
    - python manager.py db init || exit 0
    - python manager.py db migrate
    - python manager.py db upgrade
  
deployment:
  production:
    branch: master
    heroku:
      appname: circle-yummy-api